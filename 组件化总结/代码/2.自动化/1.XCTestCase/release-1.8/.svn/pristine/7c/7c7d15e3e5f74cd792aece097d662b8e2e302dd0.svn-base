//
//  CYTCommitPriceInfoCell.m
//  CYTEasyPass
//
//  Created by Jentle on 2017/8/30.
//  Copyright © 2017年 EasyPass. All rights reserved.
//

#import "CYTCommitPriceInfoCell.h"
#import "CYTOrderCommitViewController.h"

@implementation CYTCommitPriceInfoCell
{
    //分割条
    UIView *_topBar;
    //成交价格
    UILabel *_dealPriceLabel;
    //成交价格 万
    UILabel *_dealPriceInfoLabel;
    //成交价格 输入框
    UITextField *_dealPriceTF;
    //成交价格分割线
    UILabel *_dealPriceLineLabel;
    
    //订金金额
    UILabel *_depositLabel;
    //订金金额 元
    UILabel *_depositInfoLabel;
    //订金金额 输入框
    UITextField *_depositTF;
    //定金说明
    UIButton *_depositDescriptionButton;
    //订金金额分割线
    UILabel *_depositLineLabel;
    //备注
    UIView *_remarkView;
    UILabel *_remarkTipLabel;
    UILabel *_placeHolderLabel;
    UILabel *_remarkLabel;
    //箭头
    UIImageView *_arrowImageView;
    UILabel *_remarkInfoLabel;
}

- (instancetype)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier{
    self = [super initWithStyle:style reuseIdentifier:reuseIdentifier];
    if (self) {
        [self commitPriceInfoBasicConfig];
        [self initCommitPriceInfoComponents];
        [self makeConstrains];
    }
    return self;
}
/**
 *  基本配置
 */
- (void)commitPriceInfoBasicConfig{
    self.backgroundColor = [UIColor whiteColor];
    self.selectionStyle = UITableViewCellSelectionStyleNone;
}
/**
 *  初始化子控件
 */
- (void)initCommitPriceInfoComponents{
    //分割条
    UIView *topBar = [[UIView alloc] init];
    topBar.backgroundColor = kColor_nor_back;
    [self.contentView addSubview:topBar];
    _topBar = topBar;
    
    //成交价格
    UILabel *dealPriceLabel = [UILabel labelWithText:@"成交价格" textColor:CYTHexColor(@"#333333") textAlignment:NSTextAlignmentLeft fontPixel:28.f setContentPriority:YES];
    [self.contentView addSubview:dealPriceLabel];
    _dealPriceLabel = dealPriceLabel;
    
    //成交价格 万
    NSString *dealPriceString = @"万 元";
    UILabel *dealPriceInfoLabel = [UILabel labelWithText:dealPriceString textColor:CYTHexColor(@"#333333") textAlignment:NSTextAlignmentRight fontPixel:26.f setContentPriority:YES];
    NSRange range = [dealPriceString rangeOfString:@"万"];
    [dealPriceInfoLabel updateWithRange:range font:CYTFontWithPixel(30) color:CYTRedColor];
    [self.contentView addSubview:dealPriceInfoLabel];
    _dealPriceInfoLabel = dealPriceInfoLabel;
    
    //成交价格 输入框
    UITextField *dealPriceTF = [UITextField textFieldWithTextColor:CYTHexColor(@"#666666") fontPixel:26.f textAlignment:NSTextAlignmentRight keyboardType:UIKeyboardTypeDecimalPad clearButtonMode:UITextFieldViewModeNever placeholder:@"请输入"];
    [dealPriceTF setValue:CYTHexColor(@"#B6B6B6") forKeyPath:@"_placeholderLabel.textColor"];
    [self.contentView addSubview:dealPriceTF];
    _dealPriceTF = dealPriceTF;
    
    //成交价格分割线
    UILabel *dealPriceLineLabel = [UILabel dividerLineLabel];
    [self.contentView addSubview:dealPriceLineLabel];
    _dealPriceLineLabel = dealPriceLineLabel;
    
    
    //订金金额
    UILabel *depositLabel = [UILabel labelWithText:@"订金金额" textColor:CYTHexColor(@"#333333") textAlignment:NSTextAlignmentLeft fontPixel:28.f setContentPriority:YES];
    [self.contentView addSubview:depositLabel];
    _depositLabel = depositLabel;
    
    //订金金额 元
    UILabel *depositInfoLabel = [UILabel labelWithText:@"元" textColor:CYTHexColor(@"#333333") textAlignment:NSTextAlignmentRight fontPixel:26.f setContentPriority:YES];
    [self.contentView addSubview:depositInfoLabel];
    _depositInfoLabel = depositInfoLabel;
    
    //订金金额 输入框
    UITextField *depositTF = [UITextField textFieldWithTextColor:CYTHexColor(@"#F43244") font:CYTBoldFontWithPixel(28.f) textAlignment:NSTextAlignmentRight keyboardType:UIKeyboardTypeNumberPad clearButtonMode:UITextFieldViewModeNever placeholder:@"请输入"];
    [depositTF setValue:CYTFontWithPixel(26.f) forKeyPath:@"_placeholderLabel.font"];
    [depositTF setValue:CYTHexColor(@"#B6B6B6") forKeyPath:@"_placeholderLabel.textColor"];
    [self.contentView addSubview:depositTF];
    _depositTF = depositTF;
    
    //定金提示
    UIButton *depositDescriptionButton = [UIButton buttonWithType:UIButtonTypeCustom];
    [depositDescriptionButton setImage:[UIImage imageNamed:@"order_commit_alert"] forState:UIControlStateNormal];
    [depositDescriptionButton setTitle:@" 您的订金将由平台为您保管，点击查看详情>>" forState:UIControlStateNormal];
    [depositDescriptionButton setTitleColor:kContentMainColor forState:UIControlStateNormal];
    depositDescriptionButton.titleLabel.font = CYTFontWithPixel(24);
    @weakify(self);
    [[depositDescriptionButton rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) {
        @strongify(self);
        !self.clickDepositAlertBlock?:self.clickDepositAlertBlock();
    }];
    [self.contentView addSubview:depositDescriptionButton];
    _depositDescriptionButton = depositDescriptionButton;
    
    
    //订金金额分割线
    UILabel *depositLineLabel = [UILabel dividerLineLabel];
    [self.contentView addSubview:depositLineLabel];
    _depositLineLabel = depositLineLabel;
    
    //备注
    CYTWeakSelf
    UIView *remarkView = [[UIView alloc] init];
    [remarkView addTapGestureRecognizerWithTap:^(UITapGestureRecognizer *tap) {
        !weakSelf.remakeClick?:weakSelf.remakeClick(_remarkLabel.text);
    }];
    remarkView.backgroundColor = [UIColor clearColor];
    [self.contentView addSubview:remarkView];
    _remarkView = remarkView;
    UILabel *remarkTipLabel = [UILabel labelWithText:@"备注" textColor:CYTHexColor(@"#333333") textAlignment:NSTextAlignmentLeft fontPixel:28.f setContentPriority:YES];
    [remarkView addSubview:remarkTipLabel];
    _remarkTipLabel = remarkTipLabel;
    
    UILabel *placeHolderLabel = [UILabel labelWithText:@"请输入" textColor:CYTHexColor(@"#B6B6B6") textAlignment:NSTextAlignmentLeft fontPixel:26.f setContentPriority:NO];
//    placeHolderLabel.hidden = YES;
    [remarkView addSubview:placeHolderLabel];
    _placeHolderLabel = placeHolderLabel;
    
    UILabel *remarkLabel = [UILabel labelWithTextColor:CYTHexColor(@"#666666") textAlignment:NSTextAlignmentLeft fontPixel:26.f setContentPriority:NO];
    remarkLabel.numberOfLines = 0;
    [remarkView addSubview:remarkLabel];
    _remarkLabel = remarkLabel;
    
    //箭头
    UIImageView *arrowImageView = [UIImageView imageViewWithImgName:@"arrow_right"];
    [self.contentView addSubview:arrowImageView];
    _arrowImageView = arrowImageView;
    
    //测试数据
//    remarkLabel.text = @"新华社北京8月31日电 中共中央政治局8月31日召开会议，研究中国共产党第十八届中央委员会第七次全体会议和中国共产党第十九次全国代表大会筹备工作。中共中央总书记习近平主持会议。";
    
}
/**
 *  布局控件
 */
- (void)makeConstrains{
    [_topBar mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(self.contentView);
        make.left.right.equalTo(self.contentView);
        make.height.equalTo(CYTAutoLayoutV(20));
        
    }];
    
    [_dealPriceLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(CYTMarginH);
        make.top.equalTo(_topBar.mas_bottom).offset(CYTMarginV);
        
    }];
    
    [_dealPriceInfoLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(_dealPriceLabel);
        make.right.equalTo(-CYTMarginH);
    }];

    [_dealPriceTF mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(_dealPriceLabel);
        make.right.equalTo(_dealPriceInfoLabel.mas_left).offset(-CYTAutoLayoutH(14.f));
        make.left.equalTo(_dealPriceLabel.mas_right).offset(CYTMarginH);
    }];
    
    [_dealPriceLineLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(CYTMarginH);
        make.right.equalTo(-CYTMarginH);
        make.height.equalTo(CYTDividerLineWH);
        make.top.equalTo(_dealPriceInfoLabel.mas_bottom).offset(CYTMarginV);
    }];
    
    [_depositLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(CYTMarginH);
        make.top.equalTo(_dealPriceLineLabel.mas_bottom).offset(CYTMarginV);
    }];

    [_depositInfoLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(_depositLabel);
        make.right.equalTo(-CYTMarginH);
    }];
    
    [_depositTF mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(_depositLabel);
        make.right.equalTo(_depositInfoLabel.mas_left).offset(-CYTAutoLayoutH(14.f));
        make.left.equalTo(_depositLabel.mas_right).offset(CYTMarginH);
    }];
    [_depositDescriptionButton makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(_depositLabel);
        make.right.lessThanOrEqualTo(-CYTMarginH);
        make.top.equalTo(_depositLabel.bottom).offset(CYTItemMarginV);
    }];
    [_depositLineLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(CYTMarginH);
        make.right.equalTo(-CYTMarginH);
        make.height.equalTo(CYTDividerLineWH);
        make.top.equalTo(_depositDescriptionButton.mas_bottom).offset(CYTMarginV);
    }];
    
    [_remarkView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.right.bottom.equalTo(self.contentView);
        make.top.equalTo(_depositLineLabel.mas_bottom);
    }];
    
    [_remarkTipLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(CYTMarginH);
        make.top.equalTo(_remarkView).offset(CYTMarginV);
    }];
    
    [_arrowImageView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.width.height.equalTo(CYTAutoLayoutV(44.f));
        make.centerY.equalTo(_remarkTipLabel);
        make.centerX.equalTo(_depositInfoLabel);
    }];
    
    [_placeHolderLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.greaterThanOrEqualTo(_remarkTipLabel.mas_right).offset(CYTItemMarginH);
        make.right.equalTo(_depositTF);
        make.top.equalTo(CYTMarginV);
        make.bottom.equalTo(-CYTMarginV);
    }];
    
    [_remarkLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.greaterThanOrEqualTo(_remarkTipLabel.mas_right).offset(CYTItemMarginH);
        make.right.equalTo(_depositTF);
        make.top.equalTo(_remarkTipLabel);
        make.bottom.equalTo(_remarkView.bottom).offset(-CYTMarginV);
    }];
    
}

/**
 *  获取成交价格
 */
- (NSString *)dealPrice{
    return _dealPriceTF.text;
}
/**
 *  订金金额
 */
- (NSString *)depositAmount{
    return _depositTF.text;
}


+ (instancetype)cellForTableView:(UITableView *)tableView indexPath:(NSIndexPath *)indexPath{
    static NSString *identifier = @"CYTCommitPriceInfoCell";
    CYTCommitPriceInfoCell *cell = [tableView dequeueReusableCellWithIdentifier:identifier];
    if (!cell){
        cell = [[CYTCommitPriceInfoCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifier];
    }
    return cell;
}

- (void)setRemark:(NSString *)remark{
    _remark = remark;
    _remarkLabel.text = remark;
    _placeHolderLabel.hidden = remark.length;
}

//0:买家  1:卖家
- (void)setCommitType:(NSInteger)commitType {
    _commitType = commitType;
    _depositDescriptionButton.hidden = commitType;
    
    if (commitType==0) {
        //如果是车源发起定金交易，为买家显示提示
        [_depositLineLabel remakeConstraints:^(MASConstraintMaker *make) {
            make.left.equalTo(CYTMarginH);
            make.right.equalTo(-CYTMarginH);
            make.height.equalTo(CYTDividerLineWH);
            make.top.equalTo(_depositDescriptionButton.mas_bottom).offset(CYTMarginV);
        }];
    }else {
        //否则不显示
        [_depositLineLabel remakeConstraints:^(MASConstraintMaker *make) {
            make.left.equalTo(CYTMarginH);
            make.right.equalTo(-CYTMarginH);
            make.height.equalTo(CYTDividerLineWH);
            make.top.equalTo(_depositLabel.mas_bottom).offset(CYTMarginV);
        }];
    }
}

@end
