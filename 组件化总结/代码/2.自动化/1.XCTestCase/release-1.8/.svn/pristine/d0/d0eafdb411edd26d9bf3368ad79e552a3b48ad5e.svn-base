//
//  FFBasicViewController.m
//  FFBasicProject
//
//  Created by xujunquan on 2017/5/7.
//  Copyright © 2017年 ian. All rights reserved.
//

#import "FFBasicViewController.h"

@interface FFBasicViewController ()
@property (nonatomic, strong) id priViewModel;

@end

@implementation FFBasicViewController

- (instancetype)init {
    if (self = [super init]) {
        [self ff_initWithViewModel:_priViewModel];
    }
    return self;
}

- (instancetype)initWithViewModel:(FFExtendViewModel *)viewModel {
    _priViewModel = viewModel;
    return [self init];
}

- (void)ff_initWithViewModel:(id)viewModel {
    self.interactivePopGestureEnable = YES;
    _showNavigationView = YES;
}

- (void)ff_bindViewModel {
    
}

- (void)ff_addSubViewAndConstraints {
    self.view.backgroundColor = [UIColor whiteColor];
    self.automaticallyAdjustsScrollViewInsets = NO;
    
    [self.view addSubview:self.ffNavigationView];
    [self.view insertSubview:self.ffContentView atIndex:0];
    
    [self.ffNavigationView makeConstraints:^(MASConstraintMaker *make) {
        make.top.left.right.equalTo(self.view);
        make.height.equalTo(kFFNavigationBarHeight+kFFStatusBarHeight);
    }];
    [self.ffContentView makeConstraints:^(MASConstraintMaker *make) {
        make.left.bottom.right.equalTo(self.view);
        make.top.equalTo(self.ffNavigationView.bottom);
    }];
}

#pragma mark-
- (void)viewDidLoad {
    [super viewDidLoad];
    self.edgesForExtendedLayout = UIRectEdgeNone;
    
    [self ff_bindViewModel];
    [self ff_addSubViewAndConstraints];
}

- (void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];
    self.navigationController.navigationBar.hidden = YES;
}

- (void)viewWillDisappear:(BOOL)animated{
    [super viewWillDisappear:animated];
    ///开启手势返回
    self.navigationController.interactivePopGestureRecognizer.enabled = YES;
    self.navigationController.navigationBar.hidden = NO;
    //退出键盘
    [self.view endEditing:YES];
}

- (void)viewDidAppear:(BOOL)animated{
    [super viewDidAppear:animated];
    //设置当前页面右滑返回手势是否有效
    self.navigationController.interactivePopGestureRecognizer.enabled = self.interactivePopGestureEnable;
}

- (void)dealloc {
    NSString *className = [NSString stringWithUTF8String:object_getClassName(self)];
    kFFLog_Debug(@"%@已执行----------->>>>,%@",NSStringFromSelector(_cmd),className);
    [[NSNotificationCenter defaultCenter] removeObserver:self];
}

#pragma mark- 导航点击方法
- (void)ff_leftClicked:(FFNavigationItemView *)backView {
    if (self.navigationController.viewControllers.count>1) {
        [self.navigationController popViewControllerAnimated:YES];
    }
}

- (void)ff_titleClicked:(FFNavigationItemView *)titleView {
    
}

- (void)ff_rightClicked:(FFNavigationItemView *)rightView {
    
}

#pragma mark- set
- (void)setFfTitle:(NSString *)ffTitle {
    _ffTitle = ffTitle;
    self.ffNavigationView.contentView.titleView.title = ffTitle;
}

- (void)setShowNavigationView:(BOOL)showNavigationView {
    _showNavigationView = showNavigationView;
    
    float height = (showNavigationView)?kFFNavigationBarHeight+kFFStatusBarHeight:0;
    [self.ffNavigationView updateConstraints:^(MASConstraintMaker *make) {
        make.height.equalTo(height);
    }];
    
    [UIView animateWithDuration:kFFAnimationDuration animations:^{
        [self.view layoutIfNeeded];
        self.ffNavigationView.contentView.alpha = (showNavigationView)?1:0;
    }];
    
    //当导航不显示时候，设置line不显示
    if (!showNavigationView) {
        self.showNavigationBottomLine = showNavigationView;
    }
}

- (void)setShowNavigationBottomLine:(BOOL)showNavigationBottomLine {
    _showNavigationBottomLine = showNavigationBottomLine;
    self.ffNavigationView.bottomLineView.hidden = !showNavigationBottomLine;
}

#pragma mark- get
- (FFNavigationView *)ffNavigationView {
    if (!_ffNavigationView) {
        _ffNavigationView = [FFNavigationView new];
        @weakify(self);
        [_ffNavigationView setLeftClickBlock:^(FFNavigationItemView *leftView) {
            @strongify(self);
            [self ff_leftClicked:leftView];
        }];
        [_ffNavigationView setTitleClickBlock:^(FFNavigationItemView *titleView) {
            @strongify(self);
            [self ff_titleClicked:titleView];
        }];
        [_ffNavigationView setRightClickBlock:^(FFNavigationItemView *rightView) {
            @strongify(self);
            [self ff_rightClicked:rightView];
        }];
    }
    return _ffNavigationView;
}

- (FFExtendView *)ffContentView {
    if (!_ffContentView) {
        _ffContentView = [FFExtendView new];
#ifdef DEBUG
#ifdef kFFDebug
        [_ffContentView radius:8 borderWidth:1 borderColor:kFFDebugViewColor];
#endif
#endif
    }
    return _ffContentView;
}

@end
